{% extends "admin_base.html" %}

{% block title %}My Preferences - JobSprint{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="fas fa-cog me-2"></i>My Job Preferences</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('user_dashboard') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>
</div>

<form method="POST">
    <div class="row">
        <!-- Job Search Preferences -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-search me-2"></i>Search Preferences</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="keywords" class="form-label">Job Keywords</label>
                        <textarea class="form-control" id="keywords" name="keywords" rows="3" 
                                  placeholder="software engineer, python developer, java developer">{% if preferences %}{{ preferences.keywords|join(', ') }}{% endif %}</textarea>
                        <div class="form-text">Separate keywords with commas. These are the job titles you're looking for.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="exclude_keywords" class="form-label">Exclude Keywords</label>
                        <textarea class="form-control" id="exclude_keywords" name="exclude_keywords" rows="2" 
                                  placeholder="senior, lead, manager">{% if preferences %}{{ preferences.exclude_keywords|join(', ') }}{% endif %}</textarea>
                        <div class="form-text">Jobs containing these words will be filtered out.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="locations" class="form-label">Preferred Locations</label>
                        <div class="mb-2">
                            <select class="form-select mb-2" id="countryFocus" name="country_focus" onchange="updateLocationSuggestions()">
                                <option value="canada" {% if preferences and preferences.country_focus == 'canada' %}selected{% endif %}>üá®üá¶ Canada Focus</option>
                                <option value="usa" {% if preferences and preferences.country_focus == 'usa' %}selected{% endif %}>üá∫üá∏ USA Focus</option>
                                <option value="india" {% if preferences and preferences.country_focus == 'india' %}selected{% endif %}>üáÆüá≥ India Focus</option>
                                <option value="global" {% if preferences and preferences.country_focus == 'global' %}selected{% endif %}>üåç Global</option>
                            </select>
                        </div>
                        <textarea class="form-control" id="locations" name="locations" rows="4"
                                  placeholder="Canada Remote, Toronto ON, Montreal QC, Vancouver BC">{% if preferences %}{{ preferences.locations|join(', ') }}{% else %}Canada Remote, Toronto ON, Montreal QC, Vancouver BC{% endif %}</textarea>
                        <div class="form-text">
                            <strong>Canada Examples:</strong> Canada Remote, Toronto ON, Montreal QC, Vancouver BC, Ontario Remote<br>
                            <small class="text-muted">Enter locations separated by commas. Use country-specific formats for better results.</small>
                        </div>

                        <!-- Quick Location Buttons for Canada -->
                        <div class="mt-2" id="canadaLocations">
                            <small class="text-muted">Quick Add Canada Locations:</small><br>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Canada Remote')">üá®üá¶ Canada Remote</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Toronto, ON')">Toronto</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Montreal, QC')">Montreal</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Vancouver, BC')">Vancouver</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Calgary, AB')">Calgary</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Ottawa, ON')">Ottawa</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('Ontario Remote')">ON Remote</button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="addLocation('BC Remote')">BC Remote</button>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="min_salary" class="form-label">Minimum Salary ($)</label>
                                <input type="number" class="form-control" id="min_salary" name="min_salary" 
                                       value="{{ preferences.min_salary if preferences else 80000 }}" min="0" step="1000">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="max_salary" class="form-label">Maximum Salary ($)</label>
                                <input type="number" class="form-control" id="max_salary" name="max_salary" 
                                       value="{{ preferences.max_salary if preferences else 200000 }}" min="0" step="1000">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Settings -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-sliders-h me-2"></i>System Settings</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="search_frequency_minutes" class="form-label">Search Frequency</label>
                        <select class="form-select" id="search_frequency_minutes" name="search_frequency_minutes">
                            <option value="5" {% if preferences and preferences.search_frequency_minutes == 5 %}selected{% endif %}>Every 5 minutes</option>
                            <option value="10" {% if preferences and preferences.search_frequency_minutes == 10 %}selected{% endif %}>Every 10 minutes</option>
                            <option value="15" {% if preferences and preferences.search_frequency_minutes == 15 %}selected{% endif %}>Every 15 minutes</option>
                            <option value="30" {% if preferences and preferences.search_frequency_minutes == 30 %}selected{% endif %}>Every 30 minutes</option>
                            <option value="60" {% if preferences and preferences.search_frequency_minutes == 60 %}selected{% endif %}>Every hour</option>
                        </select>
                        <div class="form-text">How often to search for new jobs.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="linkedin_quality_threshold" class="form-label">LinkedIn Quality Threshold</label>
                        <input type="range" class="form-range" id="linkedin_quality_threshold" name="linkedin_quality_threshold" 
                               min="0" max="100" value="{{ preferences.linkedin_quality_threshold if preferences else 65 }}"
                               oninput="updateQualityValue(this.value)">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">Low (0)</small>
                            <small class="text-muted">Quality: <span id="qualityValue">{{ preferences.linkedin_quality_threshold if preferences else 65 }}</span>/100</small>
                            <small class="text-muted">High (100)</small>
                        </div>
                        <div class="form-text">Only LinkedIn jobs above this quality score will be sent to you.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="max_hours_old" class="form-label">Maximum Job Age (hours)</label>
                        <select class="form-select" id="max_hours_old" name="max_hours_old">
                            <option value="6" {% if preferences and preferences.max_hours_old == 6 %}selected{% endif %}>6 hours</option>
                            <option value="12" {% if preferences and preferences.max_hours_old == 12 %}selected{% endif %}>12 hours</option>
                            <option value="24" {% if preferences and preferences.max_hours_old == 24 %}selected{% endif %}>24 hours</option>
                            <option value="48" {% if preferences and preferences.max_hours_old == 48 %}selected{% endif %}>48 hours</option>
                            <option value="72" {% if preferences and preferences.max_hours_old == 72 %}selected{% endif %}>72 hours</option>
                        </select>
                        <div class="form-text">Only jobs posted within this timeframe will be considered.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Save Button -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Ready to save your preferences?</h6>
                            <small class="text-muted">Your job automation will use these settings to find the best opportunities for you.</small>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>Save Preferences
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Help Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Tips for Better Results</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="fas fa-lightbulb text-warning me-2"></i>Keywords</h6>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Use specific job titles</li>
                            <li>‚Ä¢ Include technology names</li>
                            <li>‚Ä¢ Try variations (e.g., "dev", "developer")</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-map-marker-alt text-info me-2"></i>Locations</h6>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Always include "Remote" if interested</li>
                            <li>‚Ä¢ Use full city names</li>
                            <li>‚Ä¢ Include state for US cities</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-star text-success me-2"></i>Quality</h6>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Higher threshold = fewer, better jobs</li>
                            <li>‚Ä¢ 65+ recommended for quality</li>
                            <li>‚Ä¢ Lower for more opportunities</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function updateQualityValue(value) {
    document.getElementById('qualityValue').textContent = value;
}

function addLocation(location) {
    const locationsTextarea = document.getElementById('locations');
    const currentLocations = locationsTextarea.value.trim();

    if (currentLocations === '') {
        locationsTextarea.value = location;
    } else {
        // Check if location already exists
        const locationsList = currentLocations.split(',').map(l => l.trim());
        if (!locationsList.includes(location)) {
            locationsTextarea.value = currentLocations + ', ' + location;
        }
    }
}

function updateLocationSuggestions() {
    const countryFocus = document.getElementById('countryFocus').value;
    const canadaLocations = document.getElementById('canadaLocations');

    if (countryFocus === 'canada') {
        canadaLocations.style.display = 'block';
        // Update placeholder for Canada
        document.getElementById('locations').placeholder = 'Canada Remote, Toronto ON, Montreal QC, Vancouver BC';
    } else {
        canadaLocations.style.display = 'none';
        // Update placeholder for other countries
        if (countryFocus === 'usa') {
            document.getElementById('locations').placeholder = 'Remote USA, New York NY, San Francisco CA, Seattle WA';
        } else if (countryFocus === 'india') {
            document.getElementById('locations').placeholder = 'Remote India, Bangalore, Mumbai, Delhi, Hyderabad';
        } else {
            document.getElementById('locations').placeholder = 'Remote, New York, London, Toronto, Sydney';
        }
    }
}

// Initialize location suggestions on page load
document.addEventListener('DOMContentLoaded', function() {
    updateLocationSuggestions();
});
</script>
{% endblock %}
