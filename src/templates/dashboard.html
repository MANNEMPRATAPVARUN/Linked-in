{% extends "base.html" %}

{% block title %}Dashboard - LinkedIn Job Automation{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
        <p class="text-muted">Monitor your job automation system and view recent findings</p>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <i class="fas fa-briefcase fa-2x mb-2"></i>
                <h3>{{ total_jobs }}</h3>
                <p class="mb-0">Total Jobs Found</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <i class="fas fa-envelope fa-2x mb-2"></i>
                <h3>{{ notifications_sent }}</h3>
                <p class="mb-0">Notifications Sent</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <i class="fas fa-clock fa-2x mb-2"></i>
                <h3>{{ config.scraping.check_interval_minutes }}min</h3>
                <p class="mb-0">Check Interval</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <i class="fas fa-globe fa-2x mb-2"></i>
                <h3>{{ config.scraping.sites|length }}</h3>
                <p class="mb-0">Job Sites</p>
            </div>
        </div>
    </div>
</div>

<!-- Control Panel -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-play-circle"></i> Control Panel</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        {% if is_monitoring %}
                            <a href="{{ url_for('stop_monitoring') }}" class="btn btn-danger btn-block w-100">
                                <i class="fas fa-stop"></i> Stop Monitoring
                            </a>
                        {% else %}
                            <a href="{{ url_for('start_monitoring') }}" class="btn btn-success btn-block w-100">
                                <i class="fas fa-play"></i> Start Monitoring
                            </a>
                        {% endif %}
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('run_job_check') }}" class="btn btn-primary btn-block w-100">
                            <i class="fas fa-search"></i> Run Job Check
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('test_email') }}" class="btn btn-info btn-block w-100">
                            <i class="fas fa-envelope-open"></i> Test Email
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('test_job_search') }}" class="btn btn-warning btn-block w-100">
                            <i class="fas fa-search"></i> Test Job Search
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('config_page') }}" class="btn btn-secondary btn-block w-100">
                            <i class="fas fa-cog"></i> Advanced Config
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Current Configuration Summary -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-bullseye"></i> Job Preferences</h6>
            </div>
            <div class="card-body">
                <p><strong>Keywords:</strong> {{ config.job_preferences.keywords|join(', ') }}</p>
                <p><strong>Locations:</strong> {{ config.job_preferences.locations|join(', ') }}</p>
                <p><strong>Min Salary:</strong> ${{ "{:,}".format(config.job_preferences.min_salary) if config.job_preferences.min_salary else 'Not set' }}</p>
                <p class="mb-0"><strong>Exclude:</strong> {{ config.job_preferences.exclude_keywords|join(', ') if config.job_preferences.exclude_keywords else 'None' }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-envelope"></i> Email Settings</h6>
            </div>
            <div class="card-body">
                <p><strong>Sender:</strong> {{ config.email.sender_email if config.email.sender_email else 'Not configured' }}</p>
                <p><strong>Recipients:</strong> {{ config.email.recipient_emails|length }} email(s)</p>
                <p><strong>SMTP:</strong> {{ config.email.smtp_server }}:{{ config.email.smtp_port }}</p>
                <p class="mb-0">
                    <strong>Status:</strong> 
                    {% if config.email.sender_email and config.email.sender_password %}
                        <span class="badge bg-success">Configured</span>
                    {% else %}
                        <span class="badge bg-warning">Needs Setup</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Recent Jobs -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list"></i> Recent Jobs Found</h5>
            </div>
            <div class="card-body">
                {% if recent_jobs %}
                    {% for job in recent_jobs %}
                    <div class="job-card card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="card-title">{{ job[0] }}</h6>
                                    <p class="card-text">
                                        <i class="fas fa-building"></i> {{ job[1] }} | 
                                        <i class="fas fa-map-marker-alt"></i> {{ job[2] }} | 
                                        <i class="fas fa-globe"></i> {{ job[3].title() }}
                                    </p>
                                    <small class="text-muted">
                                        <i class="fas fa-clock"></i> Found: {{ job[4] }}
                                    </small>
                                </div>
                                <div class="col-md-4 text-end">
                                    {% if job[5] %}
                                        <span class="badge bg-success mb-2">
                                            <i class="fas fa-check"></i> Notified
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary mb-2">
                                            <i class="fas fa-clock"></i> Pending
                                        </span>
                                    {% endif %}
                                    <br>
                                    <a href="{{ job[6] }}" target="_blank" class="btn btn-primary btn-sm">
                                        <i class="fas fa-external-link-alt"></i> View Job
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5>No jobs found yet</h5>
                        <p class="text-muted">Start monitoring to begin finding job opportunities!</p>
                        <a href="{{ url_for('start_monitoring') }}" class="btn btn-primary">
                            <i class="fas fa-play"></i> Start Monitoring
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
